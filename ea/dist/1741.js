"use strict";(self.webpackChunkvolumetric_atmospheric_scattering=self.webpackChunkvolumetric_atmospheric_scattering||[]).push([[1741],{186:(e,t,s)=>{s.d(t,{H:()=>h});class n{constructor(){this._createSubNodePromises={},this._isDisposed=!1,this._subNodes={},this._onSubNodeDisposed=e=>{const t=e;delete this._subNodes[t.name],this._onSubNodesChanged()}}callOnSubNode(e,t){const s=this.getSubNode(e);s?t(s):this._createSubNodePromisesResolvedAsync().then(()=>{const s=this.getSubNode(e);s?t(s):this.createAndAddSubNodeAsync(e).then(e=>{t(e)})})}createAndAddSubNodeAsync(e){var t;return(t=this._createSubNodePromises)[e]||(t[e]=this._createSubNode(e).then(e=>(this._addSubNode(e),e))),this._createSubNodePromises[e]}dispose(){this._isDisposed=!0;const e=Object.values(this._subNodes);for(const t of e)t.dispose();this._subNodes={},this._createSubNodePromises={}}getSubNode(e){return this._subNodes[e]??null}async removeSubNodeAsync(e){await this._createSubNodePromisesResolvedAsync();const t=e.name;this._subNodes[t]&&delete this._subNodes[t],delete this._createSubNodePromises[t],this._onSubNodesChanged()}async _createSubNodePromisesResolvedAsync(){return await Promise.all(Object.values(this._createSubNodePromises))}_addSubNode(e){this._isDisposed?e.dispose():(this._subNodes[e.name]=e,e.onDisposeObservable.addOnce(this._onSubNodeDisposed),this._onSubNodesChanged())}}var o=s(9844),i=s(6744),r=s(1856),a=s(9281);class u extends i.Sy{constructor(e){super(e);const t=this.node=new GainNode(e._audioContext);this._volume=new a.k(e,t.gain)}dispose(){super.dispose(),this._volume.dispose()}get volume(){return this._volume.value}set volume(e){this.setVolume(e)}get _inNode(){return this.node}get _outNode(){return this.node}setVolume(e,t=null){this._volume.setTargetValue(e,t)}_connect(e){return!!super._connect(e)&&(e._inNode&&this.node.connect(e._inNode),!0)}_disconnect(e){return!!super._disconnect(e)&&(e._inNode&&this.node.disconnect(e._inNode),!0)}getClassName(){return"_VolumeWebAudioSubNode"}}var c=s(7930);class l extends o.i_{constructor(e){super(e),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode=new AnalyserNode(e._audioContext)}get fftSize(){return this._analyzerNode.fftSize}set fftSize(e){e!==this._analyzerNode.fftSize&&(this._analyzerNode.fftSize=e,this._clearArrays())}get _inNode(){return this._analyzerNode}get minDecibels(){return this._analyzerNode.minDecibels}set minDecibels(e){this._analyzerNode.minDecibels=e}get maxDecibels(){return this._analyzerNode.maxDecibels}set maxDecibels(e){this._analyzerNode.maxDecibels=e}get smoothing(){return this._analyzerNode.smoothingTimeConstant}set smoothing(e){this._analyzerNode.smoothingTimeConstant=e}dispose(){super.dispose(),this._clearArrays(),this._byteFrequencyData=null,this._floatFrequencyData=null,this._analyzerNode.disconnect()}getClassName(){return"_WebAudioAnalyzerSubNode"}getByteFrequencyData(){return this._byteFrequencyData&&0!==this._byteFrequencyData.length||(this._byteFrequencyData=new Uint8Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getByteFrequencyData(this._byteFrequencyData),this._byteFrequencyData}getFloatFrequencyData(){return this._floatFrequencyData&&0!==this._floatFrequencyData.length||(this._floatFrequencyData=new Float32Array(this._analyzerNode.frequencyBinCount)),this._analyzerNode.getFloatFrequencyData(this._floatFrequencyData),this._floatFrequencyData}_clearArrays(){this._byteFrequencyData?.set((0,c.hU)()),this._floatFrequencyData?.set((0,c.Hi)())}}class h extends n{constructor(e){super(),this._outputNode=null,this._owner=e}async initAsync(e){const t=(0,r.GA)(e);if(t&&await this.createAndAddSubNodeAsync("Analyzer"),await this.createAndAddSubNodeAsync("Volume"),await this._createSubNodePromisesResolvedAsync(),t){const t=(0,o.CA)(this);if(!t)throw new Error("No analyzer subnode.");t.setOptions(e)}const s=(0,i.sf)(this);if(!s)throw new Error("No volume subnode.");if(s.setOptions(e),"_VolumeWebAudioSubNode"!==s.getClassName())throw new Error("Not a WebAudio subnode.");if(this._outputNode=s.node,this._outputNode&&this._downstreamNodes){const e=this._downstreamNodes.values();for(let t=e.next();!t.done;t=e.next()){const e=t.value._inNode;e&&this._outputNode.connect(e)}}}get _inNode(){return this._outputNode}get _outNode(){return this._outputNode}_createSubNode(e){switch(e){case"Analyzer":return async function(e){return new l(e)}(this._owner.engine);case"Volume":return async function(e){return new u(e)}(this._owner.engine);default:throw new Error(`Unknown subnode name: ${e}`)}}_onSubNodesChanged(){const e=(0,o.CA)(this),t=(0,i.sf)(this);e&&t&&t.connect(e)}}},516:(e,t,s)=>{s.d(t,{e:()=>o});var n=s(6846);class o extends n.Ui{constructor(e,t){super(e,t,3)}connect(e){if(!this._connect(e))throw new Error("Connect failed")}disconnect(e){if(!this._disconnect(e))throw new Error("Disconnect failed")}disconnectAll(){if(!this._downstreamNodes)throw new Error("Disconnect failed");const e=this._downstreamNodes.values();for(let t=e.next();!t.done;t=e.next())if(!this._disconnect(t.value))throw new Error("Disconnect failed")}}},1856:(e,t,s)=>{s.d(t,{GA:()=>o,IR:()=>n,zx:()=>i});const n={fftSize:2048,minDecibels:-100,maxDecibels:-30,smoothing:.8};function o(e){return e.analyzerEnabled||void 0!==e.analyzerFFTSize||void 0!==e.analyzerMinDecibels||void 0!==e.analyzerMaxDecibels||void 0!==e.analyzerSmoothing}class i{get frequencyBinCount(){return this.fftSize/2}}},4988:(e,t,s)=>{s.d(t,{t:()=>r});var n=s(6846),o=s(6744),i=s(7930);class r extends n.Ui{constructor(e,t,s){super(e,t,s),this._analyzer=null}get analyzer(){return this._analyzer??(this._analyzer=new i.sQ(this._subGraph))}get volume(){return(0,o.pN)(this._subGraph,"volume")}set volume(e){const t=(0,o.sf)(this._subGraph);if(!t)throw new Error("No volume subnode");t.volume=e}dispose(){super.dispose(),this._analyzer?.dispose(),this._analyzer=null,this._subGraph.dispose()}setVolume(e,t=null){const s=(0,o.sf)(this._subGraph);if(!s)throw new Error("No volume subnode");s.setVolume(e,t)}}},6744:(e,t,s)=>{s.d(t,{Sy:()=>i,pN:()=>a,sf:()=>r});var n=s(516);const o={volume:1};class i extends n.e{constructor(e){super("Volume",e)}setOptions(e){this.volume=e.volume??o.volume}}function r(e){return e.getSubNode("Volume")}function a(e,t){return r(e)?.[t]??o[t]}},7930:(e,t,s)=>{s.d(t,{Hi:()=>c,hU:()=>u,sQ:()=>l});var n=s(1137),o=s(1856),i=s(9844);let r=null,a=null;function u(){return r||(r=new Uint8Array),r}function c(){return a||(a=new Float32Array),a}class l extends o.zx{constructor(e){super(),this._fftSize=o.IR.fftSize,this._maxDecibels=o.IR.maxDecibels,this._minDecibels=o.IR.minDecibels,this._smoothing=o.IR.smoothing,this._subGraph=e}get fftSize(){return this._fftSize}set fftSize(e){this._fftSize=e,(0,i.Z7)(this._subGraph,"fftSize",e)}get isEnabled(){return null!==(0,i.CA)(this._subGraph)}get minDecibels(){return this._minDecibels}set minDecibels(e){this._minDecibels=e,(0,i.Z7)(this._subGraph,"minDecibels",e)}get maxDecibels(){return this._maxDecibels}set maxDecibels(e){this._maxDecibels=e,(0,i.Z7)(this._subGraph,"maxDecibels",e)}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,(0,i.Z7)(this._subGraph,"smoothing",e)}dispose(){const e=(0,i.CA)(this._subGraph);e&&(this._subGraph.removeSubNodeAsync(e),e.dispose())}async enableAsync(){(0,i.CA)(this._subGraph)||await this._subGraph.createAndAddSubNodeAsync("Analyzer")}getByteFrequencyData(){const e=(0,i.CA)(this._subGraph);return e?e.getByteFrequencyData():(n.V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),u())}getFloatFrequencyData(){const e=(0,i.CA)(this._subGraph);return e?e.getFloatFrequencyData():(n.V.Warn("AudioAnalyzer not enabled"),this.enableAsync(),c())}}},9844:(e,t,s)=>{s.d(t,{CA:()=>r,Z7:()=>a,i_:()=>i});var n=s(1856),o=s(516);class i extends o.e{constructor(e){super("Analyzer",e)}setOptions(e){this.fftSize=e.analyzerFFTSize??n.IR.fftSize,this.minDecibels=e.analyzerMinDecibels??n.IR.minDecibels,this.maxDecibels=e.analyzerMaxDecibels??n.IR.maxDecibels,this.smoothing=e.analyzerSmoothing??n.IR.smoothing}}function r(e){return e.getSubNode("Analyzer")}function a(e,t,s){e.callOnSubNode("Analyzer",e=>{e[t]=s})}}}]);