"use strict";(self.webpackChunkvolumetric_atmospheric_scattering=self.webpackChunkvolumetric_atmospheric_scattering||[]).push([[6464],{5877:(t,e,r)=>{var a=r(854),o=r(1137),n=r(655),l=r(8688),s=r(9323),f=r(8454);s.$.prototype._partialLoadFile=function(t,e,r,a,o=null){this._loadFile(t,t=>{r[e]=t,r._internalCount++,6===r._internalCount&&a(r)},void 0,void 0,!0,(t,e)=>{o&&t&&o(t.status+" "+t.statusText,e)})},s.$.prototype._cascadeLoadFiles=function(t,e,r,a=null){const o=[];o._internalCount=0;for(let t=0;t<6;t++)this._partialLoadFile(r[t],t,o,e,a)},s.$.prototype._cascadeLoadImgs=function(t,e,r,a,o=null,n){const l=[];l._internalCount=0;for(let s=0;s<6;s++)this._partialLoadImg(a[s],s,l,t,e,r,o,n)},s.$.prototype._partialLoadImg=function(t,e,r,a,o,s,f=null,i){const u=(0,l.z)();(0,n.W$)(t,t=>{r[e]=t,r._internalCount++,a&&a.removePendingData(u),6===r._internalCount&&s&&s(o,r)},(t,e)=>{a&&a.removePendingData(u),f&&f(t,e)},a?a.offlineProvider:null,i),a&&a.addPendingData(u)},s.$.prototype.createCubeTextureBase=function(t,e,r,n,l=null,s=null,i,u=null,c=!1,A=0,d=0,y=null,p=null,h=null,_=!1,b=null){const B=y||new a.h(this,7);B.isCube=!0,B.url=t,B.generateMipMaps=!n,B._lodGenerationScale=A,B._lodGenerationOffset=d,B._useSRGBBuffer=!!_&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!n),B!==y&&(B.label=t.substring(0,60)),this._doNotHandleContextLost||(B._extension=u,B._files=r,B._buffer=b);const G=t;this._transformTextureUrl&&!y&&(t=this._transformTextureUrl(t));const F=u??function(t){const e=t.split("?")[0],r=e.lastIndexOf(".");return r>-1?e.substring(r).toLowerCase():""}(t),C=(0,f.gT)(F),m=(t,e)=>{B.dispose(),s?s(t,e):t&&o.V.Warn(t)},w=(a,s)=>{t===G?a&&m(a.status+" "+a.statusText,s):(o.V.Warn(`Failed to load ${t}, falling back to the ${G}`),this.createCubeTextureBase(G,e,r,!!n,l,m,i,u,c,A,d,B,p,h,_,b))};if(C)C.then(a=>{const o=t=>{p&&p(B,t),a.loadCubeData(t,B,c,l,(t,e)=>{m(t,e)})};b?o(b):r&&6===r.length?a.supportCascades?this._cascadeLoadFiles(e,t=>o(t.map(t=>new Uint8Array(t))),r,m):m("Textures type does not support cascades."):this._loadFile(t,t=>o(new Uint8Array(t)),void 0,e?e.offlineProvider||null:void 0,!0,w)});else{if(!r||0===r.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(e,B,(t,e)=>{h&&h(t,e)},r,m)}return this._internalTexturesCache.push(B),B}},6464:(t,e,r)=>{r.d(e,{DDSTools:()=>y});var a=r(4867),o=r(1137),n=r(6755),l=r(8864);r(5877);const s=131072,f=131072;function i(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const u=i("DXT1"),c=i("DXT3"),A=i("DXT5"),d=i("DX10");class y{static GetDDSInfo(t){const e=new Int32Array(t.buffer,t.byteOffset,31),r=new Int32Array(t.buffer,t.byteOffset,35);let a=1;e[2]&s&&(a=Math.max(1,e[7]));const o=e[21],n=o===d?r[32]:0;let l=0;switch(o){case 113:l=2;break;case 116:l=1;break;case d:if(10===n){l=2;break}if(2===n){l=1;break}}return{width:e[4],height:e[3],mipmapCount:a,isFourCC:!(4&~e[20]),isRGB:!(64&~e[20]),isLuminance:(e[20]&f)===f,isCube:!(512&~e[28]),isCompressed:o===u||o===c||o===A,dxgiFormat:n,textureType:l}}static _GetHalfFloatAsFloatRGBAArrayBuffer(t,e,r,a,o,n){const s=new Float32Array(a),f=new Uint16Array(o,r);let i=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const a=4*(e+r*t);s[i]=(0,l.SX)(f[a]),s[i+1]=(0,l.SX)(f[a+1]),s[i+2]=(0,l.SX)(f[a+2]),y.StoreLODInAlphaChannel?s[i+3]=n:s[i+3]=(0,l.SX)(f[a+3]),i+=4}return s}static _GetHalfFloatRGBAArrayBuffer(t,e,r,a,o,n){if(y.StoreLODInAlphaChannel){const s=new Uint16Array(a),f=new Uint16Array(o,r);let i=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const a=4*(e+r*t);s[i]=f[a],s[i+1]=f[a+1],s[i+2]=f[a+2],s[i+3]=(0,l.LZ)(n),i+=4}return s}return new Uint16Array(o,r,a)}static _GetFloatRGBAArrayBuffer(t,e,r,a,o,n){if(y.StoreLODInAlphaChannel){const l=new Float32Array(a),s=new Float32Array(o,r);let f=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const a=4*(e+r*t);l[f]=s[a],l[f+1]=s[a+1],l[f+2]=s[a+2],l[f+3]=n,f+=4}return l}return new Float32Array(o,r,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(t,e,r,a,o,n){const s=new Uint16Array(a),f=new Float32Array(o,r);let i=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++)s[i]=(0,l.LZ)(f[i]),s[i+1]=(0,l.LZ)(f[i+1]),s[i+2]=(0,l.LZ)(f[i+2]),y.StoreLODInAlphaChannel?s[i+3]=(0,l.LZ)(n):s[i+3]=(0,l.LZ)(f[i+3]),i+=4;return s}static _GetFloatAsUIntRGBAArrayBuffer(t,e,r,o,n,l){const s=new Uint8Array(o),f=new Float32Array(n,r);let i=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const o=4*(e+r*t);s[i]=255*(0,a.OQ)(f[o]),s[i+1]=255*(0,a.OQ)(f[o+1]),s[i+2]=255*(0,a.OQ)(f[o+2]),y.StoreLODInAlphaChannel?s[i+3]=l:s[i+3]=255*(0,a.OQ)(f[o+3]),i+=4}return s}static _GetHalfFloatAsUIntRGBAArrayBuffer(t,e,r,o,n,s){const f=new Uint8Array(o),i=new Uint16Array(n,r);let u=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const o=4*(e+r*t);f[u]=255*(0,a.OQ)((0,l.SX)(i[o])),f[u+1]=255*(0,a.OQ)((0,l.SX)(i[o+1])),f[u+2]=255*(0,a.OQ)((0,l.SX)(i[o+2])),y.StoreLODInAlphaChannel?f[u+3]=s:f[u+3]=255*(0,a.OQ)((0,l.SX)(i[o+3])),u+=4}return f}static _GetRGBAArrayBuffer(t,e,r,a,o,n,l,s,f){const i=new Uint8Array(a),u=new Uint8Array(o,r);let c=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const a=4*(e+r*t);i[c]=u[a+n],i[c+1]=u[a+l],i[c+2]=u[a+s],i[c+3]=u[a+f],c+=4}return i}static _ExtractLongWordOrder(t){return 0===t||255===t||-16777216===t?0:1+y._ExtractLongWordOrder(t>>8)}static _GetRGBArrayBuffer(t,e,r,a,o,n,l,s){const f=new Uint8Array(a),i=new Uint8Array(o,r);let u=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const a=3*(e+r*t);f[u]=i[a+n],f[u+1]=i[a+l],f[u+2]=i[a+s],u+=3}return f}static _GetLuminanceArrayBuffer(t,e,r,a,o){const n=new Uint8Array(a),l=new Uint8Array(o,r);let s=0;for(let r=0;r<e;r++)for(let e=0;e<t;e++){const a=e+r*t;n[s]=l[a],s++}return n}static UploadDDSLevels(t,e,r,a,l,f,i=-1,p,h=!0){let _=null;a.sphericalPolynomial&&(_=[]);const b=!!t.getCaps().s3tc;e.generateMipMaps=l;const B=new Int32Array(r.buffer,r.byteOffset,31);let G,F,C,m,w,x,g,L=0,O=0,D=1;if(542327876!==B[0])return void o.V.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void o.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!b)return void o.V.Error("Compressed textures are not supported on this platform.");let R=B[22];m=B[1]+4;let U=!1;if(a.isFourCC)switch(G=B[21],G){case u:D=8,O=33777;break;case c:D=16,O=33778;break;case A:D=16,O=33779;break;case 113:U=!0,R=64;break;case 116:U=!0,R=128;break;case d:{m+=20;let t=!1;switch(a.dxgiFormat){case 10:U=!0,R=64,t=!0;break;case 2:U=!0,R=128,t=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,R=32,t=!0}if(t)break}default:return void o.V.Error(["Unsupported FourCC code:",(S=G,String.fromCharCode(255&S,S>>8&255,S>>16&255,S>>24&255))])}var S;const T=y._ExtractLongWordOrder(B[23]),k=y._ExtractLongWordOrder(B[24]),I=y._ExtractLongWordOrder(B[25]),v=y._ExtractLongWordOrder(B[26]);U&&(O=t._getRGBABufferInternalSizedFormat(a.textureType)),x=1,B[2]&s&&!1!==l&&(x=Math.max(1,B[7]));const H=p||0,M=t.getCaps();for(let o=H;o<f;o++){for(F=B[4],C=B[3],g=0;g<x;++g){if(-1===i||i===g){const n=-1===i?g:0;if(!a.isCompressed&&a.isFourCC){e.format=5,L=F*C*4;let a=null;if(t._badOS||t._badDesktopOS||!M.textureHalfFloat&&!M.textureFloat)128===R?(a=y._GetFloatAsUIntRGBAArrayBuffer(F,C,r.byteOffset+m,L,r.buffer,n),_&&0==n&&_.push(y._GetFloatRGBAArrayBuffer(F,C,r.byteOffset+m,L,r.buffer,n))):64===R&&(a=y._GetHalfFloatAsUIntRGBAArrayBuffer(F,C,r.byteOffset+m,L,r.buffer,n),_&&0==n&&_.push(y._GetHalfFloatAsFloatRGBAArrayBuffer(F,C,r.byteOffset+m,L,r.buffer,n))),e.type=0;else{const t=M.textureFloat&&(h&&M.textureFloatLinearFiltering||!h),o=M.textureHalfFloat&&(h&&M.textureHalfFloatLinearFiltering||!h),l=(128===R||64===R&&!o)&&t?1:(64===R||128===R&&!t)&&o?2:0;let s,f=null;if(128===R)switch(l){case 1:s=y._GetFloatRGBAArrayBuffer,f=null;break;case 2:s=y._GetFloatAsHalfFloatRGBAArrayBuffer,f=y._GetFloatRGBAArrayBuffer;break;case 0:s=y._GetFloatAsUIntRGBAArrayBuffer,f=y._GetFloatRGBAArrayBuffer}else switch(l){case 1:s=y._GetHalfFloatAsFloatRGBAArrayBuffer,f=null;break;case 2:s=y._GetHalfFloatRGBAArrayBuffer,f=y._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:s=y._GetHalfFloatAsUIntRGBAArrayBuffer,f=y._GetHalfFloatAsFloatRGBAArrayBuffer}e.type=l,a=s(F,C,r.byteOffset+m,L,r.buffer,n),_&&0==n&&_.push(f?f(F,C,r.byteOffset+m,L,r.buffer,n):a)}a&&t._uploadDataToTextureDirectly(e,a,o,n)}else if(a.isRGB)e.type=0,24===R?(e.format=4,L=F*C*3,w=y._GetRGBArrayBuffer(F,C,r.byteOffset+m,L,r.buffer,T,k,I),t._uploadDataToTextureDirectly(e,w,o,n)):(e.format=5,L=F*C*4,w=y._GetRGBAArrayBuffer(F,C,r.byteOffset+m,L,r.buffer,T,k,I,v),t._uploadDataToTextureDirectly(e,w,o,n));else if(a.isLuminance){const a=t._getUnpackAlignement(),l=F;L=Math.floor((F+a-1)/a)*a*(C-1)+l,w=y._GetLuminanceArrayBuffer(F,C,r.byteOffset+m,L,r.buffer),e.format=1,e.type=0,t._uploadDataToTextureDirectly(e,w,o,n)}else L=Math.max(4,F)/4*Math.max(4,C)/4*D,w=new Uint8Array(r.buffer,r.byteOffset+m,L),e.type=0,t._uploadCompressedDataToTextureDirectly(e,O,F,C,w,o,n)}m+=R?F*C*(R/8):L,F*=.5,C*=.5,F=Math.max(1,F),C=Math.max(1,C)}if(void 0!==p)break}_&&_.length>0?a.sphericalPolynomial=n.d.ConvertCubeMapToSphericalPolynomial({size:B[4],right:_[0],left:_[1],up:_[2],down:_[3],front:_[4],back:_[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}y.StoreLODInAlphaChannel=!1}}]);